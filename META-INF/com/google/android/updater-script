# Before: ui_print("  Hi! ");
# Now:    ui_print " Hi! "
#-----------Dynamic Installer Configs-----------#
#The #MAGISK tag is required, dont remove it
#MAGISK
setdefault magisk_support on
setdefault import_addons off
setdefault apex_mount off
setdefault extraction_speed default
setdefault permissions "0:0:0755:0644"
setdefault devices off
#-----------------------------------------------#
#Your script starts here:
ui_print "Seal Os Boot Animation Installer"
#make custom boot animation finding function
bootanimation() {
    #find_in system oem #backup
    for find in "$@"; do
        if [[ "$find_in" == "system" ]]; then
           local native_anim=$(find /system -type f -name bootanimation.zip)
           if exist "$native_anim"; then
              ui_print "Found bootanimation.zip"
           else
              abort "CANT FIND: bootanimation.zip"
           fi
        else [[ "$find_in" == "oem" ]]; then
             local native_anim=$(find /oem -type f -name bootanimation.zip)
             if exist "$native_anim"; then
                ui_print "Found bootanimation.zip"
             else
                abort "CANT FIND: bootanimation.zip"
             fi
        fi
    done 
    for backup in "$@"; do
        move $native_anim /sdcard/BootAnimationBackup/bootanimation.zip
    done
}
ui_print "-- Mounting partitions --"
mount_all
#Check if Samsung or Samsung based rom
ui_print "Checking if you are using Samsung or Samsung based rom"
if exist file "/system/media/bootsamsung.qmg"; then
   abort "You are using Samsung or Samsung based rom"
else
   ui_print "You aren't using Samsung or Samsung based rom"
fi
ui_print "Finding bootanimation.zip"
#figure out where the boot animation is located. This part uses code from BlassGo's  Bootanimation_Maker[1.1] script 
bootanimation find_in /system 
#check if seal os boot animation is installed 
if check_content "sealos.txt" "$native_anim"; then
   ui_print "Seal Os Boot Animation Is already Installed"
else
   ui_print "Seal Os Boot Animation isn't installed"
   bootanimation backup
   ui_print "-- Installing Seal Os boot animation --"
   package_extract_file "system/media/SealOsBootAnimation.zip" $native_anim
fi
#addon.d script
ui_print "Checking if rom has addon.d support"
if exist folder "/system/addon.d"; then
   ui_print "Rom has addon.d support"
   ui_print "Checking if Seal Os Boot Animation addon.d survival script is installed"
   #Check if there already is a back up script
   if exist file "system/addon.d/19-SealOsBootAnimation.sh"; then
      ui_print "Updateing Survival Script"
      delete /system/addon.d/19-SealOsBootAnimation.sh
      package_extract_file "system/addon.d/19-SealOsBootAnimation.sh" /system/addon.d/19-SealOsBootAnimation.sh
      replace "bootanimation.zip" "$native_anim" /system/addon.d/19-SealOsBootAnimation.sh
      remove "/system/" /system/addon.d/19-SealOsBootAnimation.sh
      replace "SealOsBootAnimation.zip" "$native_anim" /system/addon.d/19-SealOsBootAnimation.sh
      set_perm 0 0 0755 /system/addon.d/19-SealOsBootAnimation.sh
   else
      ui_print "addon.d survival script isn't installed"
      ui_print "Installing Survival Script"
      package_extract_file "system/addon.d/19-SealOsBootAnimation.sh" /system/addon.d/19-SealOsBootAnimation.sh
      replace "bootanimation.zip" "$native_anim" /system/addon.d/19-SealOsBootAnimation.sh
      remove "/system/" /system/addon.d/19-SealOsBootAnimation.sh
      replace "SealOsBootAnimation.zip" "$native_anim" /system/addon.d/19-SealOsBootAnimation.sh
      set_perm 0 0 0755 /system/addon.d/19-SealOsBootAnimation.sh
   fi
else
   ui_print "Rom doesn't have addon.d support"
fi
#make Uninstaller
ui_print "Making Uninstaller"
script=$(read_file "$addons/uninstall-script.txt")
make_zip -s "$script" -t recovery -pm -o "/sdcard/BootAnimationBackup/BootAnimationUninstaller.zip"
ui_print "Finished Making Uninstaller"
ui_print "You can find it in the /sdcard/BootAnimationBackup folder"
ui_print "-- Unmounting ALL --"
umount_all
ui_print " "
ui_print "-- Done --"
