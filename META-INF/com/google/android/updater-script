# Before: ui_print("  Hi! ");
# Now:    ui_print " Hi! "
#-----------Dynamic Installer Configs-----------#
#The #MAGISK tag is required, dont remove it
#MAGISK
setdefault magisk_support on
setdefault import_addons on
setdefault apex_mount off
setdefault extraction_speed default
setdefault permissions "0:0:0755:0644"
setdefault devices off
#-----------------------------------------------#
#Your script starts here:
if [[ ${installzip,,} == *uninstall.zip ]] ; then
   run_uninstall_script
fi
ui_print "Seal Os Boot Animation Installer"
ui_print "-- Mounting partitions --"
mount_all
ui_print "Finding bootanimation.zip"
#use custom bootanimation function to find the boot animation 
bootanimation_find
#check if seal os boot animation is installed 
if check_content "sealos.txt" "$native_anim"; then
   version=$(package_extract_file "sealos.txt" "$native_anim")
   sed -i "2"'d' $version
   if [[ $version == "Seal Os Boot Animation V1.6" ]] ; then
      ui_print "-- Seal Os Boot Animation Is Already Installed --"
   else
      ui_print "-- Updateing Seal Os Boot Animation --"
      ui_print "Backing Up Current Boot Animation"
      bootanimation_backup /sdcard
      ui_print "-- Installing Seal Os Boot Animation --"
      package_extract_file "system/media/SealOsBootAnimation.zip" $native_anim
   fi
else
   ui_print "-- Backing Up Current Boot Animation --"
   bootanimation_backup /sdcard
   ui_print "-- Installing Seal Os Boot Animation --"
   package_extract_file "system/media/SealOsBootAnimation.zip" $native_anim
fi
#addon.d script
if [ -d /system/addon.d ]; then
   ui_print "-- Rom Has Addon.d Support --"
   ui_print "Checking If Seal Os Boot Animation Addon.d Script Is Installed"
   #Check if there already is a back up script
   if [ -f /system/addon.d/19-SealOsBootAnimation.sh ]; then
      ui_print "-- Updateing Survival Script --"
      #deletes any other addon.d scripts that I made to prevent bootanimation.zip from being backed up multiple times
      rm -f /system/addon.d/1[19]-*BootAnimation.sh
      package_extract_file "system/addon.d/19-SealOsBootAnimation.sh" /system/addon.d/19-SealOsBootAnimation.sh
      replace "bootanimation.zip" "${native_anim#/system/}" /system/addon.d/19-SealOsBootAnimation.sh
      replace "SealOsBootAnimation.zip" "$native_anim" /system/addon.d/19-SealOsBootAnimation.sh
      set_perm 0 0 0755 /system/addon.d/19-SealOsBootAnimation.sh
   else
      ui_print "Addon.d Survival Script Isn't Installed"
      ui_print "-- Installing Survival Script --"
      package_extract_file "system/addon.d/19-SealOsBootAnimation.sh" /system/addon.d/19-SealOsBootAnimation.sh
      replace "bootanimation.zip" "${native_anim#/system/}" /system/addon.d/19-SealOsBootAnimation.sh
      replace "SealOsBootAnimation.zip" "$native_anim" /system/addon.d/19-SealOsBootAnimation.sh
      set_perm 0 0 0755 /system/addon.d/19-SealOsBootAnimation.sh
   fi
else
   end "Done Rom Doesn't Have Addon.d Support"
fi
ui_print "-- Unmounting ALL --"
umount_all
ui_print "-- Done --"
