# Before: ui_print("  Hi! ");
# Now:    ui_print " Hi! "
#-----------Dynamic Installer Configs-----------#
#The #MAGISK tag is required, dont remove it
#MAGISK
setdefault magisk_support on
setdefault ensure_root on
setdefault import_addons on
setdefault apex_mount off
setdefault extraction_speed default
setdefault permissions "0:0:0755:0644"
setdefault devices off
#-----------------------------------------------#
#Your script starts here:
if [[ $(basename "${installzip,,}") == uninstall.zip ]]; then
   package_extract_file "META-INF/com/google/android/uninstall-script" $TMP/uninstall-script
   . $TMP/uninstall-script
fi
ui_print "Seal Os Boot Animation Installer"
ui_print "-- Mounting partitions --"
mount_all
ba -find
#check if seal os boot animation is installed 
if check_content "sealos.txt" "$native_anim"; then
   import_config_zip "system/media/BOOTANIMATION/sealos.txt"
   package_extract_file sealos.txt "$TMP/sealos.txt" "$native_anim"
   if grep -q INSTALLED_ANIM_VER "$TMP/sealos.txt"; then
      get_file_prop $TMP/sealos.txt "INSTALLED_ANIM_VER"
   else
      INSTALLED_ANIM_VER=$(sed -n '1p' "$TMP/sealos.txt" | grep -Eo '[0-9].[0-9]' | sed 's/\.//g')
   fi 
   if [ $INSTALLED_ANIM_VER -ge $AVAILABLE_ANIM_VER ]; then
      ui_print "-- Seal Os Boot Animation is already installed --"
   else
      ui_print "-- Updateing to Seal Os Boot Animation V${AVAILABLE_ANIM_VER%[0-9]}.${AVAILABLE_ANIM_VER#[0-9]} --"
      install_boot_anim
   fi
else
   ba -backup
   ui_print "-- Installing Seal Os Boot Animation --"
   install_boot_anim
fi
#addon.d script
if [ -d /system/addon.d ]; then
   addond=/system/addon.d
   if [ -f $addond/1[19]-SealOsBootAnimation.sh ]; then
      ui_print "-- Updateing addon.d survival script --"
   elif [ -f $addond/1[19]-*BootAnimation.sh ]; then
      ui_print "-- Installing addon.d survival script --"
      rm -f $addond/1[19]-*BootAnimation.sh
   else
      ui_print "-- Installing addon.d survival script --"
   fi
   package_extract_file "${addond#/}/19-SealOsBootAnimation.sh" $addond/19-SealOsBootAnimation.sh
   sed -i "/cat <<EOF/a ${native_anim#/system/}" $addond/19-SealOsBootAnimation.sh
   sed -i "s/SealOsBootAnimation.zip/$native_anim/" $addond/19-SealOsBootAnimation.sh
   set_perm 0 0 0755 $addond/19-SealOsBootAnimation.sh
fi
ui_print "-- Unmounting ALL --"
umount_all
ui_print "-- Done --"
